<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://nominatim.org/develop/Database-Layout/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Database Layout - Nominatim 4.2.4</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../extra.css" rel="stylesheet" />
        <link href="../../styles.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Database Layout";
        var mkdocs_page_input_path = "develop/Database-Layout.md";
        var mkdocs_page_url = "/develop/Database-Layout/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Nominatim 4.2.4
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Search/">Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Reverse/">Reverse</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Lookup/">Address Lookup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Details/">Details</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Status/">Status</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Output/">Place Output Formats</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/Faq/">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Administration Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Installation/">Basic Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Import/">Import</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Deployment/">Deploy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Setup-Nominatim-UI/">Nominatim UI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Advanced-Installations/">Advanced Installations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Maintenance/">Maintenance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Migration/">Migration from older Versions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../admin/Faq/">Troubleshooting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Customization Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Import-Styles/">Import Styles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Settings/">Configuration Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Country-Settings/">Per-Country Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Ranking/">Place Ranking</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Importance/">Importance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Tokenizers/">Tokenizers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Special-Phrases/">Special Phrases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Tiger/">External data: US housenumbers from TIGER</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../customize/Postcodes/">External data: Postcodes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developers Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Architecture Overview</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Database Layout</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#import-tables">Import tables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#search-tables">Search tables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#address-computation-tables">Address computation tables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#static-data-tables">Static data tables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#auxiliary-data-tables">Auxiliary data tables</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Indexing/">Indexing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Tokenizers/">Tokenizers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ICU-Tokenizer-Modules/">Custom modules for ICU tokenizer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Development-Environment/">Setup for Development</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Testing/">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../data-sources/">External Data Sources</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-18/">Installation on Ubuntu 18</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-20/">Installation on Ubuntu 20</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-22/">Installation on Ubuntu 22</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Nominatim 4.2.4</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Developers Guide &raquo;</li>
      <li>Database Layout</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/openstreetmap/Nominatim/edit/master/docs/develop/Database-Layout.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="database-layout">Database Layout<a class="headerlink" href="#database-layout" title="Permanent link"></a></h1>
<h3 id="import-tables">Import tables<a class="headerlink" href="#import-tables" title="Permanent link"></a></h3>
<p>OSM data is initially imported using <a href="https://osm2pgsql.org">osm2pgsql</a>.
Nominatim uses its own data output style 'gazetteer', which differs from the
output style created for map rendering.</p>
<p>The import process creates the following tables:</p>
<p><img alt="osm2pgsql tables" src="../osm2pgsql-tables.svg" /></p>
<p>The <code>planet_osm_*</code> tables are the usual backing tables for OSM data. Note
that Nominatim uses them to look up special relations and to find nodes on
ways.</p>
<p>The gazetteer style produces a single table <code>place</code> as output with the following
columns:</p>
<ul>
<li><code>osm_type</code> - kind of OSM object (<strong>N</strong> - node, <strong>W</strong> - way, <strong>R</strong> - relation)</li>
<li><code>osm_id</code> - original OSM ID</li>
<li><code>class</code> - key of principal tag defining the object type</li>
<li><code>type</code> - value of principal tag defining the object type</li>
<li><code>name</code> - collection of tags that contain a name or reference</li>
<li><code>admin_level</code> - numerical value of the tagged administrative level</li>
<li><code>address</code> - collection of tags defining the address of an object</li>
<li><code>extratags</code> - collection of additional interesting tags that are not
                 directly relevant for searching</li>
<li><code>geometry</code> - geometry of the object (in WGS84)</li>
</ul>
<p>A single OSM object may appear multiple times in this table when it is tagged
with multiple tags that may constitute a principal tag. Take for example a
motorway bridge. In OSM, this would be a way which is tagged with
<code>highway=motorway</code> and <code>bridge=yes</code>. This way would appear in the <code>place</code> table
once with <code>class</code> of <code>highway</code> and once with a <code>class</code> of <code>bridge</code>. Thus the
<em>unique key</em> for <code>place</code> is (<code>osm_type</code>, <code>osm_id</code>, <code>class</code>).</p>
<p>How raw OSM tags are mapped to the columns in the place table is to a certain
degree configurable. See <a href="../../customize/Import-Styles/">Customizing Import Styles</a>
for more information.</p>
<h3 id="search-tables">Search tables<a class="headerlink" href="#search-tables" title="Permanent link"></a></h3>
<p>The following tables carry all information needed to do the search:</p>
<p><img alt="search tables" src="../search-tables.svg" /></p>
<p>The <strong>placex</strong> table is the central table that saves all information about the
searchable places in Nominatim. The basic columns are the same as for the
place table and have the same meaning. The placex tables adds the following
additional columns:</p>
<ul>
<li><code>place_id</code> - the internal unique ID to identify the place</li>
<li><code>partition</code> - the id to use with partitioned tables (see below)</li>
<li><code>geometry_sector</code> - a location hash used for geographically close ordering</li>
<li><code>parent_place_id</code> - the next higher place in the address hierarchy, only
   relevant for POI-type places (with rank 30)</li>
<li><code>linked_place_id</code> - place ID of the place this object has been merged with.
   When this ID is set, then the place is invisible for search.</li>
<li><code>importance</code> - measure how well known the place is</li>
<li><code>rank_search</code>, <code>rank_address</code> - search and address rank (see <a href="../../customize/Ranking/">Customizing ranking</a></li>
<li><code>wikipedia</code> - the wikipedia page used for computing the importance of the place</li>
<li><code>country_code</code> - the country the place is located in</li>
<li><code>housenumber</code> - normalized housenumber, if the place has one</li>
<li><code>postcode</code> - computed postcode for the place</li>
<li><code>indexed_status</code> - processing status of the place (0 - ready, 1 - freshly inserted, 2 - needs updating, 100 - needs deletion)</li>
<li><code>indexed_date</code> - timestamp when the place was processed last</li>
<li><code>centroid</code> - a point feature for the place</li>
</ul>
<p>The <strong>location_property_osmline</strong> table is a special table for
<a href="https://wiki.openstreetmap.org/wiki/Addresses#Using_interpolation">address interpolations</a>.
The columns have the same meaning and use as the columns with the same name in
the placex table. Only three columns are special:</p>
<ul>
<li><code>startnumber</code> and <code>endnumber</code> - beginning and end of the number range
    for the interpolation</li>
<li><code>interpolationtype</code> - a string <code>odd</code>, <code>even</code> or <code>all</code> to indicate
    the interval between the numbers</li>
</ul>
<p>Address interpolations are always ways in OSM, which is why there is no column
<code>osm_type</code>.</p>
<p>The <strong>location_postcode</strong> table holds computed centroids of all postcodes that
can be found in the OSM data. The meaning of the columns is again the same
as that of the placex table.</p>
<p>Every place needs an address, a set of surrounding places that describe the
location of the place. The set of address places is made up of OSM places
themselves. The <strong>place_addressline</strong> table cross-references for each place
all the places that make up its address. Two columns define the address
relation:</p>
<ul>
<li><code>place_id</code> - reference to the place being addressed</li>
<li><code>address_place_id</code> - reference to the place serving as an address part</li>
</ul>
<p>The most of the columns cache information from the placex entry of the address
part. The exceptions are:</p>
<ul>
<li><code>fromarea</code> - is true if the address part has an area geometry and can
    therefore be considered preceise</li>
<li><code>isaddress</code> - is true if the address part should show up in the address
    output. Sometimes there are multiple places competing for for same address
    type (e.g. multiple cities) and this field resolves the tie.</li>
</ul>
<p>The <strong>search_name</strong> table contains the search index proper. It saves for each
place the terms with which the place can be found. The terms are split into
the name itself and all terms that make up the address. The table mirrors some
of the columns from placex for faster lookup.</p>
<p>Search terms are not saved as strings. Each term is assigned an integer and those
integers are saved in the name and address vectors of the search_name table. The
<strong>word</strong> table serves as the lookup table from string to such a word ID. The
exact content of the word table depends on the <a href="../Tokenizers/">tokenizer</a> used.</p>
<h2 id="address-computation-tables">Address computation tables<a class="headerlink" href="#address-computation-tables" title="Permanent link"></a></h2>
<p>Next to the main search tables, there is a set of secondary helper tables used
to compute the address relations between places. These tables are partitioned.
Each country is assigned a partition number in the country_name table (see
below) and the data is then split between a set of tables, one for each
partition. Note that Nominatim still manually manages partitioned tables.
Native support for partitions in PostgreSQL only became usable with version 13.
It will be a little while before Nominatim drops support for older versions.</p>
<p><img alt="address tables" src="../address-tables.svg" /></p>
<p>The <strong>search_name_X</strong> tables are used to look up streets that appear in the
<code>addr:street</code> tag.</p>
<p>The <strong>location_area_large_X</strong> tables are used to look up larger areas
(administrative boundaries and place nodes) either through their geographic
closeness or through <code>addr:*</code> entries.</p>
<p>The <strong>location_road_X</strong> tables are used to find the closest street for a
dependent place.</p>
<p>All three table cache specific information from the placex table for their
selected subset of places:</p>
<ul>
<li><code>keywords</code> and <code>name_vector</code> contain lists of term ids (from the word table)
   that the full name of the place should match against</li>
<li><code>isguess</code> is true for places that are not described by an area</li>
</ul>
<p>All other columns reflect their counterpart in the placex table.</p>
<h2 id="static-data-tables">Static data tables<a class="headerlink" href="#static-data-tables" title="Permanent link"></a></h2>
<p>Nominatim also creates a number of static tables at import:</p>
<ul>
<li><code>nominatim_properties</code> saves settings that must not be changed after
    import</li>
<li><code>address_levels</code> save the rank information from the
   <a href="../../customize/Ranking/">ranking configuration</a></li>
<li><code>country_name</code> contains a fallback of names for all countries, their
   default languages and saves the assignment of countries to partitions.</li>
<li><code>country_osm_grid</code> provides a fallback for country geometries</li>
</ul>
<h2 id="auxiliary-data-tables">Auxiliary data tables<a class="headerlink" href="#auxiliary-data-tables" title="Permanent link"></a></h2>
<p>Finally there are some table for auxiliary data:</p>
<ul>
<li><code>location_property_tiger</code> - saves housenumber from the Tiger import. Its
   layout is similar to that of <code>location_propoerty_osmline</code>.</li>
<li><code>place_class_*</code> tables are helper tables to facilitate lookup of POIs
   by their class and type. They exist because it is not possible to create
   combined indexes with geometries.</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../overview/" class="btn btn-neutral float-left" title="Architecture Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Indexing/" class="btn btn-neutral float-right" title="Indexing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/openstreetmap/Nominatim" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../overview/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Indexing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
